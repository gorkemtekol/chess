
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Georgia', serif; background-color: #ffffff; min-height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        body.hard-mode { background-color: #c0392b; }
        
        /* Versiyon Bilgisi Sağ Alt */
        #version-tag { 
            position: fixed; 
            bottom: 10px; 
            right: 15px; 
            font-size: 11px; 
            color: #999; 
            font-family: sans-serif; 
            letter-spacing: 0.5px;
            pointer-events: none;
            z-index: 3000;
        }
        body.hard-mode #version-tag { color: rgba(255,255,255,0.5); }

        /* Kullanıcı Bilgisi Sol Üst */
        #user-info-area { position: absolute; top: 20px; left: 20px; font-size: 18px; font-weight: bold; color: #000; display: flex; align-items: center; gap: 10px; z-index: 100; }
        #change-name { font-size: 11px; cursor: pointer; text-decoration: underline; color: #666; font-weight: normal; }
        body.hard-mode #user-info-area { color: #fff; }

        /* Dil Menüsü Sağ Üst */
        #lang-wrapper { position: absolute; top: 20px; right: 20px; z-index: 2000; }
        #lang-btn { background: #fff; border: 2px solid #000; padding: 8px 15px; cursor: pointer; font-weight: bold; font-size: 14px; min-width: 120px; text-align: center; }
        #lang-content { display: none; position: absolute; right: 0; background: #fff; border: 2px solid #000; border-top: none; min-width: 120px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        #lang-wrapper:hover #lang-content { display: block; }
        .lang-option { padding: 10px; cursor: pointer; font-size: 13px; border-bottom: 1px solid #eee; }
        .lang-option:hover { background: #f0f0f0; }
        .lang-option:last-child { border: none; }

        /* Giriş ve Menüler */
        #login-screen { position: fixed; inset: 0; background: #fff; z-index: 1000; display: none; flex-direction: column; justify-content: center; align-items: center; gap: 20px; }
        #login-screen input { padding: 15px; font-size: 20px; border: 3px solid #000; width: 300px; outline: none; }
        #menu, #difficulty-menu, #side-choice-menu { display: flex; flex-direction: column; align-items: center; gap: 40px; }
        #difficulty-menu, #side-choice-menu, #game { display: none; }
        
        h1 { font-size: 64px; font-weight: bold; letter-spacing: 8px; text-transform: uppercase; text-align: center; }
        .menu-btn { padding: 18px 50px; font-size: 20px; background-color: #d0d0d0; border: 3px solid #000; cursor: pointer; min-width: 280px; }
        .menu-btn:hover { background-color: #b0b0b0; }

        .side-buttons { display: flex; gap: 30px; }
        .side-btn { width: 150px; height: 150px; border: 3px solid #000; background-color: #d0d0d0; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.3s; }
        .side-btn:hover { background-color: #fff; transform: scale(1.05); }
        .side-btn img { width: 100px; height: 100px; pointer-events: none; }

        /* Oyun Tahtası */
        #game { flex-direction: row; gap: 30px; padding: 20px; }
        #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); border: 3px solid #000; user-select: none; }
        #board.flipped { transform: rotate(180deg); }
        #board.flipped .square img { transform: rotate(180deg); }

        .square { width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; position: relative; }
        .white { background-color: #ffffff; }
        .black { background-color: #000000; }
        .square img { width: 50px; height: 50px; z-index: 5; cursor: grab; }
        
        .highlight::after { content: ''; position: absolute; inset: 0; background-color: rgba(0, 128, 0, 0.4); z-index: 1; pointer-events: none; }
        .selected { outline: 3px solid #444; outline-offset: -3px; }

        /* Notografi Paneli */
        .move-history-panel { display: flex; flex-direction: column-reverse; gap: 20px; width: 220px; }
        .move-sheet { background-color: #f5f5f5; border: 2px solid #000; padding: 15px; min-height: 200px; }
        .move-list { font-size: 14px; max-height: 180px; overflow-y: auto; font-family: monospace; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 2000; }
        .modal-content { background: #fff; padding: 40px; border: 3px solid #000; text-align: center; }
    </style>
</head>
<body>

    <div id="version-tag">v0.5.2 Beta | Work In Progress</div>

    <div id="user-info-area">
        <span id="user-display-name"></span>
        <span id="change-name" onclick="forceNewName()"></span>
    </div>

    <div id="lang-wrapper">
        <div id="lang-btn">Language</div>
        <div id="lang-content">
            <div class="lang-option" onclick="changeLang('en')">English</div>
            <div class="lang-option" onclick="changeLang('tr')">Türkçe</div>
            <div class="lang-option" onclick="changeLang('es')">Español</div>
            <div class="lang-option" onclick="changeLang('de')">Deutsch</div>
            <div class="lang-option" onclick="changeLang('ru')">Русский</div>
            <div class="lang-option" onclick="changeLang('fr')">Français</div>
        </div>
    </div>

    <div id="login-screen">
        <h1 id="txt-welcome">HOŞ GELDİN</h1>
        <input type="text" id="username-input" placeholder="...">
        <button class="menu-btn" id="btn-save" onclick="saveName()">KAYDET</button>
    </div>

    <div id="menu">
        <h1 id="txt-logo">SATRANÇ</h1>
        <div class="menu-buttons">
            <button class="menu-btn" id="btn-ai" onclick="prepare('ai')"></button>
            <button class="menu-btn" id="btn-human" onclick="prepare('human')"></button>
        </div>
    </div>

    <div id="difficulty-menu">
        <h1 id="txt-diff-title">ZORLUK</h1>
        <button class="menu-btn" id="btn-easy" onclick="setDiff('easy')"></button>
        <button class="menu-btn" id="btn-med" onclick="setDiff('medium')"></button>
        <button class="menu-btn" id="btn-hard" onclick="showHard()"></button>
    </div>

    <div id="side-choice-menu">
        <h1 id="txt-side-title">RENK SEÇ</h1>
        <div class="side-buttons">
            <button class="side-btn" onclick="start('w')"><img src="https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wk.png"></button>
            <button class="side-btn" onclick="start('b')"><img src="https://images.chesscomfiles.com/chess-themes/pieces/neo/150/bk.png"></button>
        </div>
    </div>

    <div id="game">
        <div class="game-left">
            <div style="display:flex; justify-content:space-between; width:480px; margin-bottom:10px;">
                <span id="turn-txt">...</span>
                <button onclick="location.reload()" id="btn-menu-back">MENÜ</button>
            </div>
            <div id="board"></div>
        </div>
        <div class="move-history-panel" id="h-panel">
            <div class="move-sheet"><h3 id="label-white"></h3><div class="move-list" id="w-moves"></div></div>
            <div class="move-sheet"><h3 id="label-black"></h3><div class="move-list" id="b-moves"></div></div>
        </div>
    </div>

    <div id="over-modal" class="modal"><div class="modal-content"><h2 id="over-txt"></h2><br><button class="menu-btn" onclick="location.reload()" id="btn-ok">TAMAM</button></div></div>
    <div id="hard-modal" class="modal"><div class="modal-content"><h2 id="txt-hard-ask">?</h2><br><button onclick="setDiff('hard')" id="btn-yes"></button> <button onclick="location.reload()" id="btn-no"></button></div></div>

    <script>
        const translations = {
            tr: { welcome: "HOŞ GELDİN", save: "KAYDET", logo: "SATRANÇ", ai: "AI", human: "İKİ OYUNCU", diff: "ZORLUK", easy: "KOLAY", med: "ORTA", hard: "ZOR", side: "TARAF SEÇ", white: "Beyaz", black: "Siyah", user: "Kullanıcı", change: "[Değiştir]", turnW: "BEYAZDA", turnB: "SİYAHDA", menu: "MENÜ", ok: "TAMAM", hardAsk: "ZOR MOD? EMİN MİSİN?", yes: "EVET", no: "HAYIR", draw: "Berabere (Materyal)", win: " Kazandı!", stalemate: "Pat!", placeholder: "İsim yazın..." },
            en: { welcome: "WELCOME", save: "SAVE", logo: "CHESS", ai: "AI", human: "TWO PLAYERS", diff: "DIFFICULTY", easy: "EASY", med: "MEDIUM", hard: "HARD", side: "PICK COLOR", white: "White", black: "Black", user: "User", change: "[Change]", turnW: "WHITE'S TURN", turnB: "BLACK'S TURN", menu: "MENU", ok: "OK", hardAsk: "HARD MODE? ARE YOU SURE?", yes: "YES", no: "NO", draw: "Draw (Material)", win: " Wins!", stalemate: "Stalemate!", placeholder: "Write name..." },
            es: { welcome: "BIENVENIDO", save: "GUARDAR", logo: "AJEDREZ", ai: "AI", human: "DOS JUGADORES", diff: "DIFICULTAD", easy: "FÁCIL", med: "MEDIO", hard: "DIFÍCIL", side: "ELEGIR COLOR", white: "Blanco", black: "Negro", user: "Usuario", change: "[Cambiar]", turnW: "TURNO BLANCO", turnB: "TURNO NEGRO", menu: "MENÚ", ok: "OK", hardAsk: "¿MODO DIFÍCIL? ¿ESTÁS SEGURO?", yes: "SÍ", no: "NO", draw: "Empate", win: " ¡Ganó!", stalemate: "¡Tablas!", placeholder: "Escribe nombre..." },
            de: { welcome: "WILLKOMMEN", save: "SPEICHERN", logo: "SCHACH", ai: "AI", human: "ZWEI SPIELER", diff: "STUFE", easy: "LEICHT", med: "MITTEL", hard: "SCHWER", side: "FARBE WÄHLEN", white: "Weiß", black: "Schwarz", user: "Benutzer", change: "[Ändern]", turnW: "WEISS AM ZUG", turnB: "SCHWARZ AM ZUG", menu: "MENÜ", ok: "OK", hardAsk: "HARTER MODUS? SICHER?", yes: "JA", no: "NEIN", draw: "Remis", win: " Hat gewonnen!", stalemate: "Patt!", placeholder: "Name schreiben..." },
            ru: { welcome: "ДОБРО ПОЖАЛОВАТЬ", save: "СОХРАНИТЬ", logo: "ШАХМАТЫ", ai: "AI", human: "ДВА ИГРОКА", diff: "СЛОЖНОСТЬ", easy: "ЛЕГКО", med: "СРЕДНЕ", hard: "СЛОЖНО", side: "ВЫБОР ЦВЕТА", white: "Белые", black: "Черные", user: "Игрок", change: "[Изм.]", turnW: "ХОД БЕЛЫХ", turnB: "ХОД ЧЕРНЫХ", menu: "МЕНЮ", ok: "ОК", hardAsk: "СЛОЖНЫЙ РЕЖИМ? УВЕРЕНЫ?", yes: "ДА", no: "НЕТ", draw: "Ничья", win: " Победил!", stalemate: "Пат!", placeholder: "Введите имя..." },
            fr: { welcome: "BIENVENUE", save: "SAUVER", logo: "ÉCHECS", ai: "AI", human: "DEUX JOUEURS", diff: "DIFFICULTÉ", easy: "FACILE", med: "MOYEN", hard: "DIFFICILE", side: "CHOISIR COULEUR", white: "Blanc", black: "Noir", user: "Utilisateur", change: "[Changer]", turnW: "AUX BLANCS", turnB: "AUX NOIRS", menu: "MENU", ok: "OK", hardAsk: "MODE DIFFICILE? SÛR?", yes: "OUI", no: "NON", draw: "Match nul", win: " A gagné!", stalemate: "Pat!", placeholder: "Écrire le nom..." }
        };

        const IMG = {
            'wK': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wk.png', 'wQ': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wq.png',
            'wR': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wr.png', 'wB': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wb.png',
            'wN': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wn.png', 'wP': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/wp.png',
            'bK': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/bk.png', 'bQ': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/bq.png',
            'bR': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/br.png', 'bB': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/bb.png',
            'bN': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/bn.png', 'bP': 'https://images.chesscomfiles.com/chess-themes/pieces/neo/150/bp.png'
        };

        let board = [], turn = 'w', myColor = 'w', mode = '', over = false, sel = null, moves = [], wH = [], bH = [];
        let userName = localStorage.getItem('chess_username');
        let lang = localStorage.getItem('chess_lang') || 'tr';

        window.onload = () => {
            updateUI();
            if (!userName) document.getElementById('login-screen').style.display = 'flex';
            else { showUsername(); document.getElementById('menu').style.display = 'flex'; }
        };

        function changeLang(l) {
            lang = l;
            localStorage.setItem('chess_lang', l);
            updateUI();
        }

        function updateUI() {
            const t = translations[lang];
            document.getElementById('txt-welcome').innerText = t.welcome;
            document.getElementById('btn-save').innerText = t.save;
            document.getElementById('username-input').placeholder = t.placeholder;
            document.getElementById('txt-logo').innerText = t.logo;
            document.getElementById('btn-ai').innerText = t.ai;
            document.getElementById('btn-human').innerText = t.human;
            document.getElementById('txt-diff-title').innerText = t.diff;
            document.getElementById('btn-easy').innerText = t.easy;
            document.getElementById('btn-med').innerText = t.med;
            document.getElementById('btn-hard').innerText = t.hard;
            document.getElementById('txt-side-title').innerText = t.side;
            document.getElementById('btn-menu-back').innerText = t.menu;
            document.getElementById('btn-ok').innerText = t.ok;
            document.getElementById('btn-yes').innerText = t.yes;
            document.getElementById('btn-no').innerText = t.no;
            document.getElementById('txt-hard-ask').innerText = t.hardAsk;
            document.getElementById('change-name').innerText = t.change;
            if (userName) showUsername();
            updateTurnTxt();
        }

        function saveName() {
            const input = document.getElementById('username-input').value.trim();
            if (input) { localStorage.setItem('chess_username', input); userName = input; showUsername(); document.getElementById('login-screen').style.display = 'none'; document.getElementById('menu').style.display = 'flex'; }
        }

        function showUsername() { document.getElementById('user-display-name').innerText = translations[lang].user + ": " + userName; }
        function forceNewName() { localStorage.removeItem('chess_username'); location.reload(); }

        function prepare(m) { mode = m; document.getElementById('menu').style.display = 'none'; if(m === 'ai') document.getElementById('difficulty-menu').style.display = 'flex'; else document.getElementById('side-choice-menu').style.display = 'flex'; }
        function setDiff(d) { if(d === 'hard') document.body.classList.add('hard-mode'); document.getElementById('difficulty-menu').style.display = 'none'; document.getElementById('hard-modal').style.display = 'none'; document.getElementById('side-choice-menu').style.display = 'flex'; }
        function showHard() { document.getElementById('hard-modal').style.display = 'flex'; }

        function start(c) {
            myColor = c;
            const bEl = document.getElementById('board');
            const hP = document.getElementById('h-panel');
            if(c === 'b') { bEl.classList.add('flipped'); hP.style.flexDirection = 'column'; }
            else { bEl.classList.remove('flipped'); hP.style.flexDirection = 'column-reverse'; }
            
            const t = translations[lang];
            if(mode === 'ai') { 
                document.getElementById('label-white').innerText = (c === 'w' ? userName : "AI"); 
                document.getElementById('label-black').innerText = (c === 'b' ? userName : "AI"); 
            } else {
                document.getElementById('label-white').innerText = t.white;
                document.getElementById('label-black').innerText = t.black;
            }
            document.getElementById('side-choice-menu').style.display = 'none';
            document.getElementById('game').style.display = 'flex';
            init();
            if(mode === 'ai' && myColor === 'b') setTimeout(aiMove, 600);
        }

        function init() {
            board = [
                ['bR','bN','bB','bQ','bK','bB','bN','bR'], ['bP','bP','bP','bP','bP','bP','bP','bP'],
                [null,null,null,null,null,null,null,null], [null,null,null,null,null,null,null,null],
                [null,null,null,null,null,null,null,null], [null,null,null,null,null,null,null,null],
                ['wP','wP','wP','wP','wP','wP','wP','wP'], ['wR','wN','wB','wQ','wK','wB','wN','wR']
            ];
            draw();
        }

        function draw() {
            const bEl = document.getElementById('board'); bEl.innerHTML = '';
            for(let r=0; r<8; r++) for(let c=0; c<8; c++) {
                const s = document.createElement('div');
                s.className = `square ${(r+c)%2===0?'white':'black'}`;
                if(board[r][c]) {
                    const img = document.createElement('img');
                    img.src = IMG[board[r][c]];
                    img.draggable = (board[r][c][0] === turn && (mode !== 'ai' || turn === myColor));
                    img.ondragstart = (e) => {
                        sel = {r, c}; moves = getLegals(r, c, board); draw();
                        e.dataTransfer.setData('text/plain', JSON.stringify({r, c}));
                    };
                    s.appendChild(img);
                }
                s.ondragover = (e) => e.preventDefault();
                s.ondrop = (e) => {
                    e.preventDefault();
                    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                    if(moves.some(m => m.r === r && m.c === c)) doMove(data.r, data.c, r, c);
                    else { sel = null; moves = []; draw(); }
                };
                s.onclick = () => {
                    if(over || (mode==='ai' && turn !== myColor)) return;
                    if(sel && moves.some(m => m.r === r && m.c === c)) doMove(sel.r, sel.c, r, c);
                    else if(board[r][c]?.[0] === turn) { sel = {r, c}; moves = getLegals(r, c, board); draw(); }
                };
                if(sel?.r === r && sel?.c === c) s.classList.add('selected');
                if(moves.some(m => m.r === r && m.c === c)) s.classList.add('highlight');
                bEl.appendChild(s);
            }
        }

        function doMove(fr, fc, tr, tc) {
            const p = board[fr][fc];
            board[tr][tc] = p; board[fr][fc] = null;
            if(p[1]==='P' && (tr===0||tr===7)) board[tr][tc] = p[0]+'Q';
            const n = `${p[1]||''}${String.fromCharCode(97+tc)}${8-tr}`;
            if(turn === 'w') document.getElementById('w-moves').innerHTML += `<div>${n}</div>`;
            else document.getElementById('b-moves').innerHTML += `<div>${n}</div>`;
            turn = turn === 'w' ? 'b' : 'w';
            sel = null; moves = []; draw(); check();
            if(!over && mode === 'ai' && turn !== myColor) setTimeout(aiMove, 600);
        }

        function getBase(r, c, b) {
            const p = b[r][c]; if(!p) return [];
            const m = [], col = p[0], t = p[1];
            const add = (nr, nc) => {
                if(nr>=0 && nr<8 && nc>=0 && nc<8) {
                    if(!b[nr][nc] || b[nr][nc][0] !== col) { m.push({r:nr, c:nc}); return !b[nr][nc]; }
                } return false;
            };
            if(t==='P') {
                const d = col==='w'?-1:1;
                if(b[r+d] && !b[r+d][c]) { m.push({r:r+d, c:c}); if(((col==='w'&&r===6)||(col==='b'&&r===1)) && !b[r+2*d][c]) m.push({r:r+2*d, c:c}); }
                [[-1,d],[1,d]].forEach(o => { if(b[r+o[1]]?.[c+o[0]] && b[r+o[1]][c+o[0]][0] !== col) m.push({r:r+o[1], c:c+o[0]}); });
            } else if(t==='N') [[-2,-1],[-2,1],[-1,-2],[-1,2],[1,-2],[1,2],[2,-1],[2,1]].forEach(o => add(r+o[0], c+o[1]));
            else if(t==='K') [[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]].forEach(o => add(r+o[0], c+o[1]));
            else {
                const ds = (t==='R')?[[0,1],[0,-1],[1,0],[-1,0]]:(t==='B')?[[1,1],[1,-1],[-1,1],[-1,-1]]:[[0,1],[0,-1],[1,0],[-1,0],[1,1],[1,-1],[-1,1],[-1,-1]];
                ds.forEach(d => { let nr=r+d[0], nc=c+d[1]; while(add(nr, nc)) { nr+=d[0]; nc+=d[1]; } });
            }
            return m;
        }

        function getLegals(r, c, b) {
            return getBase(r, c, b).filter(m => {
                const tmp = b.map(row => [...row]); tmp[m.r][m.c] = tmp[r][c]; tmp[r][c] = null;
                return !inCheck(b[r][c][0], tmp);
            });
        }

        function inCheck(col, b) {
            let kr, kc; for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(b[r][c]===col+'K'){kr=r; kc=c;}
            const opp = col==='w'?'b':'w';
            for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(b[r][c]?.startsWith(opp)) if(getBase(r,c,b).some(m=>m.r===kr && m.c===kc)) return true;
            return false;
        }

        function check() {
            let ps = []; for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(board[r][c]) ps.push(board[r][c]);
            const t = translations[lang];
            if(ps.length === 2) return end(t.draw);
            const has = board.some((row, r) => row.some((p, c) => p?.startsWith(turn) && getLegals(r, c, board).length > 0));
            if(!has) {
                if(inCheck(turn, board)) end((turn==='w' ? t.black : t.white) + t.win);
                else end(t.stalemate);
            }
            updateTurnTxt();
        }

        function updateTurnTxt() {
            const t = translations[lang];
            document.getElementById('turn-txt').innerText = turn==='w' ? t.turnW : t.turnB;
        }

        function end(txt) { over = true; document.getElementById('over-txt').innerText = txt; document.getElementById('over-modal').style.display = 'flex'; }

        function aiMove() {
            let mvs = [];
            for(let r=0; r<8; r++) for(let c=0; c<8; c++) if(board[r][c]?.startsWith(turn)) getLegals(r,c,board).forEach(m=>mvs.push({fr:r, fc:c, tr:m.r, tc:m.c, cap:board[m.r][m.c]}));
            if(!mvs.length) return;
            mvs.sort((a,b) => (b.cap?1:0)-(a.cap?1:0));
            const b = mvs[0]; doMove(b.fr, b.fc, b.tr, b.tc);
        }
    </script>
</body>
</html>
